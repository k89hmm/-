<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ì¢Œí˜•ì˜ ì•ˆë¯¼ì²  í”¼í•˜ê¸°</title>
<style>
/* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ê·¸ëŒ€ë¡œ */
body {
    margin:0; padding:20px;
    background:#111;
    font-family:system-ui;
    color:#fff;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:12px;
}
h1 {margin:0; text-align:center;}
#controls {
    display:flex; gap:12px; align-items:center;
}
button {
    padding:8px 12px;
    border-radius:6px;
    border:none;
    background:#2b6df6;
    color:white;
    cursor:pointer;
}
#score { font-weight:700; }
canvas {
    width:100%;
    max-width:480px;
    height:auto;
    background:#000;
    border-radius:8px;
    box-shadow:0 6px 24px rgba(0,0,0,0.6);
    display:block;
    touch-action: none;
}
#top-scores {
    margin-top:12px;
    text-align:center;
}
</style>

<!-- Firebase ê³µì‹ CDN 9.22.1 -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getFirestore, collection, addDoc, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

// ğŸ”¹ ì—¬ê¸°ì— ìì‹ ì˜ Firebase ì„¤ì • ì…ë ¥
const firebaseConfig = {
    'apiKey': "AIzaSyA4uk5Iv6UPOX_P2d-tKkZd1p9E8m2rV44",
    'authDomain': "aaaa-85ddd.firebaseapp.com",
    'databaseURL': "https://aaaa-85ddd-default-rtdb.firebaseio.com",
    'projectId': "aaaa-85ddd",
    'storageBucket': "aaaa-85ddd.firebasestorage.app",
    'messagingSenderId': "947357162592",
    'appId': "1:947357162592:web:599896666a79b4b219f705",
    'measurementId': "G-KVHXK6GR39"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ì ìˆ˜ ì—…ë¡œë“œ
window.uploadScore = async function(name, score) {
    try {
        await addDoc(collection(db, "scores"), { name: name, score: score });
        await showTopScores();
    } catch(err) {
        console.error("Firebase upload error:", err);
    }
};

// ìƒìœ„ 5ëª… ì ìˆ˜ ë¶ˆëŸ¬ì˜¤ê¸°
window.showTopScores = async function() {
    const scoresDiv = document.getElementById("top-scores");
    const q = query(collection(db, "scores"), orderBy("score", "desc"), limit(5));
    const querySnapshot = await getDocs(q);

    let html = "<h3>Top 5 Players</h3><ol>";
    querySnapshot.forEach(doc => {
        const data = doc.data();
        html += `<li>${data.name}: ${data.score}</li>`;
    });
    html += "</ol>";
    scoresDiv.innerHTML = html;
};
</script>

<script src="https://cdn.jsdelivr.net/npm/brython@3.12.1/brython.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/brython@3.12.1/brython_stdlib.js"></script>
</head>
<body onload="brython()">

<h1>ì¢Œí˜•ì˜ ì•ˆë¯¼ì²  í”¼í•˜ê¸°</h1>
<div id="controls">
  <button id="start">ì‹œì‘</button>
  <div id="score">ì ìˆ˜: 0</div>
</div>
<canvas id="game" width="480" height="640"></canvas>

<!-- ğŸ”¹ Top 5 ì ìˆ˜ í‘œì‹œ ì˜ì—­ -->
<div id="top-scores"></div>

<script type="text/python3">
from browser import document, html, timer, window
import math, random

# ê¸°ì¡´ ê²Œì„ ì½”ë“œ ê·¸ëŒ€ë¡œ ìœ ì§€ (player, bullets, update, draw ë“±)

# ğŸ”¹ ê²Œì„ ì˜¤ë²„ ì‹œ ì´ë¦„ ì…ë ¥í•˜ê³  Firebase ì—…ë¡œë“œ
def ask_name_and_upload():
    name = window.prompt("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:", "Player")
    if name:
        window.uploadScore(name, score)

# ğŸ”¹ ê²Œì„ ë£¨í”„ ìˆ˜ì •: ê²Œì„ ì˜¤ë²„ ì‹œ ask_name_and_upload í˜¸ì¶œ
def game_loop():
    update(16)
    draw()
    if not running and game_started:
        show_game_over()
        ask_name_and_upload()  # ê²Œì„ ì˜¤ë²„ í›„ ì´ë¦„ ì…ë ¥ ë° ì ìˆ˜ ì—…ë¡œë“œ

# ê¸°ì¡´ í‚¤ë³´ë“œ, í„°ì¹˜, ì‹œì‘ ë²„íŠ¼, ë£¨í”„ ì½”ë“œ ê·¸ëŒ€ë¡œ ìœ ì§€
</script>
</body>
</html>
