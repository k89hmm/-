<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>좌형의 안민철 피하기</title>
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Arial;
      display: flex; flex-direction: column; align-items: center; gap: 12px; margin: 20px; background:#111; color:#eee;
    }
    #header { display:flex; align-items:center; gap:12px; }
    #score { font-weight:700; }
    canvas { background:#0b1220; border-radius:8px; box-shadow:0 6px 24px rgba(0,0,0,0.6); touch-action: none; }
    button { padding:8px 12px; border-radius:6px; border:none; background:#2b6df6; color:white; cursor:pointer; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/brython@3.12.1/brython.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/brython@3.12.1/brython_stdlib.js"></script>
</head>
<body onload="brython()">
  <h1>좌형의 안민철 피하기</h1>
  <div id="header">
    <button id="start">게임 시작</button>
    <div id="score">점수: 0</div>
  </div>
  <canvas id="game" width="480" height="640"></canvas>

<script type="text/python3">
from browser import document, html, timer
import math, random

CANVAS = document['game']
ctx = CANVAS.getContext('2d')
W, H = CANVAS.width, CANVAS.height

# ---------------------- 플레이어 설정 ----------------------
player = {'x': W/2, 'y': H/2, 'w': 50, 'h': 50, 'speed': 6}
player_img = html.IMG()
player_img.src = 'player.png'
player_loaded = False

def image_loaded(ev):
    global player_loaded
    player_loaded = True
player_img.bind('load', image_loaded)

# ---------------------- 총알 설정 ----------------------
bullets = []
spawn_interval = 700
last_spawn = 0
running = False
paused = False
score = 0
keys = {'left': False, 'right': False, 'up': False, 'down': False}

def spawn_bullet():
    side = random.choice(['top','bottom','left','right'])
    if side == 'top':
        x = random.uniform(0, W)
        y = -20
        vx = random.uniform(-1,1)
        vy = random.uniform(2,4)
    elif side == 'bottom':
        x = random.uniform(0, W)
        y = H+20
        vx = random.uniform(-1,1)
        vy = -random.uniform(2,4)
    elif side == 'left':
        x = -20
        y = random.uniform(0, H)
        vx = random.uniform(2,4)
        vy = random.uniform(-1,1)
    elif side == 'right':
        x = W+20
        y = random.uniform(0, H)
        vx = -random.uniform(2,4)
        vy = random.uniform(-1,1)
    r = random.uniform(6,14)
    bullets.append({'x':x, 'y':y, 'vx':vx, 'vy':vy, 'r':r})

# ---------------------- 게임 업데이트 ----------------------
def update(dt):
    global last_spawn, score, running

    if not running or paused:
        return

    last_spawn += dt
    if last_spawn >= spawn_interval:
        last_spawn = 0
        spawn_bullet()

    # 플레이어 이동
    if keys['left']: player['x'] -= player['speed']
    if keys['right']: player['x'] += player['speed']
    if keys['up']: player['y'] -= player['speed']
    if keys['down']: player['y'] += player['speed']

    player['x'] = max(player['w']/2, min(W - player['w']/2, player['x']))
    player['y'] = max(player['h']/2, min(H - player['h']/2, player['y']))

    # 총알 이동
    for b in list(bullets):
        b['x'] += b['vx']
        b['y'] += b['vy']
        if b['x'] < -50 or b['x'] > W+50 or b['y'] < -50 or b['y'] > H+50:
            bullets.remove(b)
            score += 1

    # 충돌 체크
    for b in bullets:
        dx = abs(player['x'] - b['x'])
        dy = abs(player['y'] - b['y'])
        if dx < b['r']*0.2 + player['w']/2 and dy < b['r']*0.5 + player['h']/2:
            running = False
            show_game_over()
            break

# ---------------------- 그리기 ----------------------
def draw():
    ctx.clearRect(0,0,W,H)
    # 배경 그리기
    ctx.fillStyle = "#111"
    ctx.fillRect(0,0,W,H)

    # 플레이어 그리기
    if player_loaded:
        ctx.drawImage(player_img, player['x']-player['w']/2, player['y']-player['h']/2, player['w'], player['h'])
    else:
        ctx.fillStyle = "#66ff99"
        ctx.fillRect(player['x']-player['w']/2, player['y']-player['h']/2, player['w'], player['h'])

    # 총알 그리기
    for b in bullets:
        ctx.beginPath()
        ctx.arc(b['x'], b['y'], b['r'], 0, 2*math.pi)
        ctx.fillStyle = "#ff6b6b"
        ctx.fill()

    document['score'].text = f"점수: {score}"

# ---------------------- 게임 루프 ----------------------
def game_loop():
    update(16)
    draw()

def loop(timestamp):
    game_loop()
    timer.request_animation_frame(loop)

# ---------------------- 키 입력 ----------------------
def on_keydown(ev):
    if ev.key in ('ArrowLeft', 'a'): keys['left']=True
    if ev.key in ('ArrowRight', 'd'): keys['right']=True
    if ev.key in ('ArrowUp', 'w'): keys['up']=True
    if ev.key in ('ArrowDown', 's'): keys['down']=True

def on_keyup(ev):
    if ev.key in ('ArrowLeft', 'a'): keys['left']=False
    if ev.key in ('ArrowRight', 'd'): keys['right']=False
    if ev.key in ('ArrowUp', 'w'): keys['up']=False
    if ev.key in ('ArrowDown', 's'): keys['down']=False

# ---------------------- 게임 시작/오버 ----------------------
def start_game(ev=None):
    global running, score, bullets
    bullets = []
    score = 0
    player['x'] = W/2
    player['y'] = H/2
    running = True

def show_game_over():
    ctx.fillStyle = 'rgba(0,0,0,0.5)'
    ctx.fillRect(0,0,W,H)
    ctx.fillStyle = "#fff"
    ctx.font = '48px sans-serif'
    ctx.textAlign = 'center'
    ctx.fillText('게임 오버', W/2, H/2 - 30)
    ctx.font = '24px sans-serif'
    ctx.fillText(f'점수: {score}', W/2, H/2 + 10)

# ---------------------- 이벤트 바인딩 ----------------------
document.bind('keydown', on_keydown)
document.bind('keyup', on_keyup)
document['start'].bind('click', start_game)

timer.request_animation_frame(loop)
</script>
</body>
</html>
