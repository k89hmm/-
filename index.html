<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1, user-scalable=no">
  <title>좌형의 안민철 피하기</title>
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Arial;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      margin: 0;
      background: #111;
      color: #eee;
      overflow: hidden; /* 모바일 스크롤 방지 */
    }
    #controls {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 8px;
    }
    canvas {
      border-radius: 8px;
      box-shadow: 0 6px 24px rgba(0,0,0,0.6);
      background: #0b1220;
      touch-action: none; /* 모바일 터치 스크롤 방지 */
    }
    button {
      padding: 8px 12px;
      border-radius: 6px;
      border: none;
      background: #2b6df6;
      color: white;
      cursor: pointer;
    }
    #score {
      font-weight: 700;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/brython@3.12.1/brython.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/brython@3.12.1/brython_stdlib.js"></script>
</head>
<body onload="brython()">
  <h1>좌형의 안민철 피하기</h1>
  <div id="controls">
    <button id="start">게임 시작</button>
    <div id="score">점수: 0</div>
  </div>
  <canvas id="game" width="480" height="640"></canvas>

  <script type="text/python3">
from browser import document, html, timer
import math, random

# --- 캔버스 ---
CANVAS = document['game']
ctx = CANVAS.getContext('2d')
W, H = CANVAS.width, CANVAS.height

# --- 플레이어 ---
player = {'x': W/2, 'y': H/2, 'w': 50, 'h': 50, 'speed': 6}
player_loaded = False
player_img = html.IMG()
player_img.src = 'player.png'  # PNG로 변경
player_img.width = player['w']
player_img.height = player['h']
def on_player_loaded(ev):
    global player_loaded
    player_loaded = True
player_img.bind('load', on_player_loaded)

# --- 배경 ---
bg_img = html.IMG()
bg_img.src = 'background.png'  # PNG로 변경
bg_loaded = False
def on_bg_loaded(ev):
    global bg_loaded
    bg_loaded = True
bg_img.bind('load', on_bg_loaded)

# --- 총알 ---
bullets = []
bullet_img = html.IMG()
bullet_img.src = 'bullet.png'  # PNG로 변경
bullet_loaded = False
def on_bullet_loaded(ev):
    global bullet_loaded
    bullet_loaded = True
bullet_img.bind('load', on_bullet_loaded)

# --- 게임 상태 ---
keys = {'left':False,'right':False,'up':False,'down':False}
running = False
score = 0
spawn_interval = 700
last_spawn = 0
difficulty_timer = 0

# --- 총알 스폰 (사방에서) ---
def spawn_bullet():
    side = random.choice(['top','bottom','left','right'])
    size = random.uniform(6,14)
    speed = random.uniform(2,4) + (score/200)
    if side == 'top':
        x = random.uniform(0,W)
        y = -size
        vx = random.uniform(-1,1)
        vy = speed
    elif side == 'bottom':
        x = random.uniform(0,W)
        y = H+size
        vx = random.uniform(-1,1)
        vy = -speed
    elif side == 'left':
        x = -size
        y = random.uniform(0,H)
        vx = speed
        vy = random.uniform(-1,1)
    else:  # right
        x = W+size
        y = random.uniform(0,H)
        vx = -speed
        vy = random.uniform(-1,1)
    bullets.append({'x':x,'y':y,'vx':vx,'vy':vy,'r':size})

# --- 업데이트 ---
def update(dt):
    global last_spawn, score, running, difficulty_timer
    if not running:
        return
    last_spawn += dt
    difficulty_timer += dt
    if last_spawn >= spawn_interval:
        last_spawn = 0
        spawn_bullet()
    if difficulty_timer >= 5000:
        difficulty_timer = 0
        for b in bullets:
            b['vx'] *= 1.5
            b['vy'] *= 1.5

    if keys['left']: player['x'] -= player['speed']
    if keys['right']: player['x'] += player['speed']
    if keys['up']: player['y'] -= player['speed']
    if keys['down']: player['y'] += player['speed']

    player['x'] = max(player['w']/2, min(W - player['w']/2, player['x']))
    player['y'] = max(player['h']/2, min(H - player['h']/2, player['y']))

    for b in list(bullets):
        b['x'] += b['vx']
        b['y'] += b['vy']
        if b['x'] < -50 or b['x'] > W+50 or b['y'] < -50 or b['y'] > H+50:
            bullets.remove(b)
            score += 1

    # 히트박스 (0.5배)
    for b in bullets:
        dx = b['x'] - player['x']
        dy = b['y'] - player['y']
        if dx*dx + dy*dy <= (b['r'] + player['w']/4)**2:
            running = False

# --- 그리기 ---
def draw():
    ctx.clearRect(0,0,W,H)
    if bg_loaded:
        ctx.drawImage(bg_img,0,0,W,H)
    else:
        ctx.fillStyle = '#0b1220'
        ctx.fillRect(0,0,W,H)

    for b in bullets:
        if bullet_loaded:
            ctx.drawImage(bullet_img,b['x']-b['r'],b['y']-b['r'],b['r']*2,b['r']*2)
        else:
            ctx.beginPath()
            ctx.arc(b['x'],b['y'],b['r'],0,2*math.pi)
            ctx.fillStyle='#ff6b6b'
            ctx.fill()

    if player_loaded:
        ctx.drawImage(player_img, player['x']-player['w']/2, player['y']-player['h']/2, player['w'], player['h'])
    else:
        ctx.fillStyle='#66ff99'
        ctx.fillRect(player['x']-player['w']/2, player['y']-player['h']/2, player['w'], player['h'])

    document['score'].text = f"점수: {score}"

    if not running:
        draw_game_over()

# --- 게임 오버 화면 ---
def draw_game_over():
    ctx.fillStyle = 'rgba(0,0,0,0.5)'
    ctx.fillRect(0,0,W,H)
    ctx.fillStyle = '#fff'
    ctx.font = '48px sans-serif'
    ctx.textAlign = 'center'
    ctx.fillText('게임 오버', W/2, H/2 - 30)
    ctx.font = '24px sans-serif'
    ctx.fillText(f'최종 점수: {score}', W/2, H/2 + 20)

# --- 게임 루프 ---
def game_loop():
    update(16)
    draw()

# --- 키 입력 ---
def on_keydown(ev):
    if ev.key in ('ArrowLeft','a'): keys['left']=True
    if ev.key in ('ArrowRight','d'): keys['right']=True
    if ev.key in ('ArrowUp','w'): keys['up']=True
    if ev.key in ('ArrowDown','s'): keys['down']=True

def on_keyup(ev):
    if ev.key in ('ArrowLeft','a'): keys['left']=False
    if ev.key in ('ArrowRight','d'): keys['right']=False
    if ev.key in ('ArrowUp','w'): keys['up']=False
    if ev.key in ('ArrowDown','s'): keys['down']=False

# --- 터치 이동 ---
def on_touch(ev):
    ev.preventDefault()
    touch = ev.touches[0]
    rect = CANVAS.getBoundingClientRect()
    player['x'] = touch.clientX - rect.left
    player['y'] = touch.clientY - rect.top

CANVAS.bind('touchstart', on_touch)
CANVAS.bind('touchmove', on_touch)

# --- 게임 시작 ---
def start_game(ev=None):
    global running, bullets, score, last_spawn, difficulty_timer, player
    bullets = []
    score = 0
    last_spawn = 0
    difficulty_timer = 0
    running = True
    player['x'] = W/2
    player['y'] = H/2

# --- 이벤트 ---
document.bind('keydown', on_keydown)
document.bind('keyup', on_keyup)
document['start'].bind('click', start_game)

# --- 애니메이션 프레임 ---
def loop(timestamp):
    game_loop()
    timer.request_animation_frame(loop)

timer.request_animation_frame(loop)
  </script>
</body>
</html>
